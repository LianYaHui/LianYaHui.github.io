(function (e) { function t(e) { var t = this; t.$elem = e.elem, t.x1 = e.x1, t.y1 = e.y1, t.x2 = e.x2, t.y2 = e.y2, t.speed = e.speed, t.delay = e.delay, t.init() } t.prototype = { init: function () { var e = this; e.$elem.css({ left: e.x1, top: e.y1 }), e.$elem.delay(e.delay).fadeIn("fast"), e.move() }, move: function () { var e = this; e.$elem.animate({ left: e.x2, top: e.y2 }, e.speed, "linear", function () { e.$elem.fadeOut("slow", function () { e.init() }) }) } }; var n = function (t) { var n = this; n.sname = t.sname, n.$wrap = e('<div class="' + n.sname + '" ></div>'), n.sparams = t.spiritParams, n.isRun = !1, n.spirits = [], n.bodyheight = e(document.body).height(), n.bodywidth = e(document.body).width(), n.ratio = Math.ceil(n.bodyheight / 500), n.appendStyle(), n.init() }; n.prototype = { init: function () { var e = this; e.isRun || (e.isRun = !0, e.createWrap(), e.createSpirit(), e.resize()) }, resize: function () { var t = this; e(window).on("resize.fallingEffect", function () { t.clearScene(), t.init() }) }, clearScene: function () { var t = this; t.isRun = !1, t.$wrap.empty().remove(), e(window).off("resize.fallingEffect") }, createWrap: function () { var t = this; t.$wrap.appendTo(e("body")) }, createSpirit: function () { var e = this; for (var n = 0; n < e.sparams.count; n++) { var r = e.randomElem(); e.$wrap.append(r); var i = Math.random() * (e.bodywidth - 100); e.spirits.push(new t({ elem: r, x1: i, y1: -Math.random() * 20 - n * 30, x2: i + 60 + Math.random() * 60, y2: e.bodyheight + 30, speed: e.getSpeed(), delay: Math.random() * e.sparams.delay })) } }, checkRange: function (e, t) { var n = this; return Math.abs(t - e) >= n.sparams.range.max ? t = e - n.sparams.range.max : Math.abs(t - e) <= n.sparams.range.min && (t = e - n.sparams.range.min), t }, getSpeed: function () { var e = this, t = e.ratio * e.sparams.speed, n = Math.random() * t; return e.checkRange(t, n) }, randomElem: function () { var t = this, n = Math.round(Math.random() * (t.sparams.elems.length - 1)), r = t.sparams.elems[n], i = e('<div class="' + r + '"></div>'); return i }, appendStyle: function () { var t = this; e(document.body).append(t.sparams.styles) } }; var r = new n({ sname: "christmas-scene", spiritParams: { elems: ["spirit-snow", "spirit-star", "spirit-tree"], count: 50, speed: 11e3, delay: 12e3, range: { max: 3e4, min: 1e3 }, styles: ['<style type="text/css">', "@keyframes rotate{0transform:rotate(0deg)}", "100%{transform:rotate(360deg)}", "@-ms-keyframes rotate {", "0%{-ms-transform:rotate(0deg)}", "100%{-ms-transform:rotate(360deg)}", "}", "@-moz-keyframes rotate {", "0%{-moz-transform:rotate(0deg)}", "100%{-moz-transform:rotate(360deg)}", "}", "@-webkit-keyframes rotate {", "0%{-webkit-transform:rotate(0deg)}", "100%{-webkit-transform:rotate(360deg)}", "}", "@-o-keyframes rotate {", "0%{-o-transform:rotate(0deg)}", "100%{-o-transform:rotate(360deg)}", "}", ".spirit-snow,.spirit-star,.spirit-tree{position:absolute;z-index:1000}", ".spirit-snow,.spirit-star{animation:rotate 2.5s linear infinite;-ms-animation:rotate 2.5s linear infinite;-moz-animation:rotate 2.5s linear infinite;-webkit-animation:rotate 2.5s linear infinite;-o-animation:rotate 2.5s linear infinite}", ".spirit-snow{background-image:url(http://p12.qhimg.com/t0142d7653d9bfa8674.png);_background-image:url(http://p10.qhimg.com/t013fc8caa416f54c8d.gif);width:18px;height:16px}", ".spirit-star{background-image:url(http://p14.qhimg.com/t016b5f3bb1de372e36.png);_background-image:url(http://p11.qhimg.com/t01f4657a6d6d50195f.gif);width:16px;height:16px}", ".spirit-tree{background-image:url(http://p10.qhimg.com/t01a5e3dc82c7765cb6.png);_background-image:url(http://p14.qhimg.com/t0104bdbe98fa0d190c.gif);width:14px;height:18px}"].join("") } }) })(jQuery);




(function () { var t, e, n, a, o, i, r = [], s = [], u = 0; requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function (e) { var n = (new Date).getTime(); var a = Math.max(0, 16 - (n - u)); t = setTimeout(function () { e(n + a) }, a); u = n + a }; cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame || window.msCancelAnimationFrame || window.oCancelAnimationFrame || function () { clearTimeout(t) }; function l() { if (!(this instanceof l)) { throw new Error("please use new() create instance"); return } if (m.call(this) == false) { return } this.status = 0; this.start() } function m() { var t = document.createElement("canvas"); this.canvas = t; var e = document.createElement("x"); e.style.cssText = "pointer-events:auto"; return !!(t.getContext && t.getContext("2d") && e.style.pointerEvents === "auto") } l.prototype.start = function () { var t = this; if (this.status === 1) { return false } this.status = 1; this.snowCanvas(); this.createFlakes(); requestAnimationFrame(c) }; l.prototype.stop = function () { if (this.status === 2) return; this.status = 2; cancelAnimationFrame() }; l.prototype.snowCanvas = function () { var t = this.canvas; e = window.innerWidth; n = window.innerHeight; t.id = "J_snowfall"; t.width = e; t.height = n; t.setAttribute("style", "position: fixed; top: 0; left: 0; z-index: 9000; pointer-events: none;"); document.body.appendChild(t); o = t; i = t.getContext("2d"); i.strokeStyle = "none"; window.onresize = function () { e = window.innerWidth; n = window.innerHeight; t.width = e; t.height = n; flakeCount = e * n / 6e3; h.createFlakes() } }; l.prototype.createFlakes = function () { var t, n, o, r, u = "#FFF", l = [.45, .55, .8, .9, 1]; r = [40, 50, 60, 80, 100]; for (var m = 0; m < 5; m++) { t = document.createElement("canvas"); t.width = r[m]; t.height = r[m]; n = t.getContext("2d"); n.font = r[m] / 2 + "px sumson"; o = n.createRadialGradient(r[m] / 2, r[m] / 2, 0, r[m] / 2, r[m] / 2, r[m] / 2); o.addColorStop(0, u); o.addColorStop(.1, u); o.addColorStop(.85, f(u, l[m])); o.addColorStop(1, f(u, 0)); n.fillStyle = o; n.fillText("*", r[m] / 2, r[m] / 2); s.push(t) } a = i.createLinearGradient(0, 0, 0, e); d() }; function d() { var t; var a = (e - 940) / 2; flakeCount = e * n / 6e3; for (var o = 0; o < flakeCount; o++) { t = o < flakeCount * .6 ? 0 : o < flakeCount * .8 ? 1 : o < flakeCount * .9 ? 2 : o < flakeCount * .98 ? 3 : 4; var i = Math.floor(Math.random() * 10) >= 5 ? a + 940 : a; var s = i < 940 ? Math.random() * i : 940 + a + Math.random() * a; r[o] = [s, Math.random() * n, t] } } function c(t) { i.fillStyle = a, i.clearRect(0, 0, e, n), i.beginPath(); for (var o = 0; o < flakeCount; o++) { var u = r[o][0]; var l = r[o][1]; var m = s[r[o][2]]; i.drawImage(m, u, l) } i.fill(); w(); requestAnimationFrame(c) } function f(t, e) { var n, a, o; t = t.replace(/^s*#|s*$/g, ""); t.length === 3 && (t = t.replace(/([0-9a-fA-F])/g, "$1$1")); n = parseInt(t.substr(0, 2), 16); a = parseInt(t.substr(2, 2), 16); o = parseInt(t.substr(4, 2), 16); return "rgba(" + n + ", " + a + ", " + o + ", " + e + ")" } function w() { var t, a, o, i, s, u, l; p = .01; a = Math.sin(p); l = (e - 940) / 2; for (var m = 0; m < flakeCount; m++) { u = r[m]; o = Math.sin(4 * p + m); u[1] += (u[2] / 2 + (2 + o)) / 2; u[0] += 6 * (a + o / 2) / (10 / u[2]); s = Math.floor(Math.random() * 10) >= 5 ? l + 940 : l; i = s < 940 ? Math.random() * s : 940 + l + Math.random() * l; u[1] > n && (u[1] = -20, u[0] = i); if (u[0] > l && u[0] < 940 + l || u[0] > e || u[0] < -20) { u[0] > e ? u[0] = -20 : u[0] = e - 20 } r[m] = u } } var h = new l })();
